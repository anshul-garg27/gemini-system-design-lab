<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topics - System Design Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{{ url_for('index') }}">
                <i class="fas fa-brain me-2"></i>System Design Generator
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">
                            <i class="fas fa-home me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('topics') }}">
                            <i class="fas fa-list me-1"></i>Topics
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('analytics') }}">
                            <i class="fas fa-chart-bar me-1"></i>Analytics
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container py-5">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h2 fw-bold text-primary mb-2">
                                <i class="fas fa-list me-2"></i>All Topics
                            </h1>
                            <p class="text-muted mb-0">Browse and manage all generated system design topics</p>
                        </div>
                        <div>
                            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                                <i class="fas fa-plus me-1"></i>Add New Topics
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm border-0">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label for="categoryFilter" class="form-label fw-semibold">
                                        <i class="fas fa-filter me-1"></i>Category
                                    </label>
                                    <select id="categoryFilter" class="form-select">
                                        <option value="">All Categories</option>
                                        <option value="system_design">System Design</option>
                                        <option value="databases">Databases</option>
                                        <option value="cloud_infrastructure">Cloud Infrastructure</option>
                                        <option value="messaging_streaming">Messaging & Streaming</option>
                                        <option value="big_tech_companies">Big Tech Companies</option>
                                        <option value="ai_ml">AI/ML</option>
                                        <option value="security">Security</option>
                                        <option value="networking">Networking</option>
                                        <option value="algorithms">Algorithms</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="complexityFilter" class="form-label fw-semibold">
                                        <i class="fas fa-layer-group me-1"></i>Complexity
                                    </label>
                                    <select id="complexityFilter" class="form-select">
                                        <option value="">All Levels</option>
                                        <option value="beginner">Beginner</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="advanced">Advanced</option>
                                        <option value="expert">Expert</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="statusFilter" class="form-label fw-semibold">
                                        <i class="fas fa-check-circle me-1"></i>Status
                                    </label>
                                    <select id="statusFilter" class="form-select">
                                        <option value="">All Status</option>
                                        <option value="completed">Completed</option>
                                        <option value="pending">Pending</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="searchInput" class="form-label fw-semibold">
                                        <i class="fas fa-search me-1"></i>Search
                                    </label>
                                    <input type="text" id="searchInput" class="form-control" placeholder="Search topics...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Topics Table -->
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-lg border-0">
                        <div class="card-header bg-white border-0 py-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="card-title mb-0">
                                    <i class="fas fa-table me-2"></i>Topics List
                                    <span class="badge bg-primary ms-2" id="topicsCount">{{ total_topics }}</span>
                                </h3>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-secondary btn-sm" onclick="refreshTopics()">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="exportTopics()">
                                        <i class="fas fa-download me-1"></i>Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="selectAll" class="form-check-input">
                                            </th>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Category</th>
                                            <th>Company</th>
                                            <th>Complexity</th>
                                            <th>Status</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="topicsTableBody">
                                        {% for topic in topics %}
                                        <tr data-topic-id="{{ topic.id }}" 
                                            data-category="{{ topic.category }}" 
                                            data-complexity="{{ topic.complexity_level }}"
                                            data-status="{{ topic.processing_status or 'completed' }}">
                                            <td>
                                                <input type="checkbox" class="form-check-input topic-checkbox" value="{{ topic.id }}">
                                            </td>
                                            <td>
                                                <span class="badge bg-primary">#{{ topic.id }}</span>
                                            </td>
                                            <td>
                                                <div class="fw-semibold">{{ topic.title }}</div>
                                                <small class="text-muted">{{ topic.description[:80] }}...</small>
                                            </td>
                                            <td>
                                                <span class="badge bg-info">{{ topic.category.replace('_', ' ').title() }}</span>
                                            </td>
                                            <td>
                                                <span class="fw-semibold text-capitalize">{{ topic.company }}</span>
                                            </td>
                                            <td>
                                                <span class="badge {% if topic.complexity_level == 'beginner' %}bg-success{% elif topic.complexity_level == 'intermediate' %}bg-warning{% elif topic.complexity_level == 'advanced' %}bg-danger{% elif topic.complexity_level == 'expert' %}bg-dark{% else %}bg-secondary{% endif %}">
                                                    {{ topic.complexity_level.title() }}
                                                </span>
                                                <small class="d-block text-muted">{{ topic.difficulty }}/10</small>
                                            </td>
                                            <td>
                                                <span class="badge {% set status = topic.processing_status or 'completed' %}{% if status == 'completed' %}bg-success{% elif status == 'pending' %}bg-warning{% elif status == 'failed' %}bg-danger{% else %}bg-secondary{% endif %}">
                                                    {{ (topic.processing_status or 'completed').title() }}
                                                </span>
                                                {% if topic.error_message %}
                                                <small class="d-block text-danger">{{ topic.error_message[:50] }}...</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <small class="text-muted">{{ topic.created_date }}</small>
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <button class="btn btn-sm btn-outline-primary" onclick="viewTopic({{ topic.id }})">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    {% if topic.processing_status == 'failed' %}
                                                    <button class="btn btn-sm btn-outline-warning" onclick="retryTopic({{ topic.id }})">
                                                        <i class="fas fa-redo"></i>
                                                    </button>
                                                    {% endif %}
                                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteTopic({{ topic.id }})">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            {% if total_topics > per_page %}
                            <div class="card-footer bg-white border-0 py-3">
                                <nav aria-label="Topics pagination">
                                    <ul class="pagination justify-content-center mb-0">
                                        {% if page > 1 %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ url_for('topics', page=page-1) }}">
                                                <i class="fas fa-chevron-left"></i>
                                            </a>
                                        </li>
                                        {% endif %}
                                        
                                        {% for p in range(max(1, page-2), min(page+3, (total_topics + per_page - 1) // per_page + 1)) %}
                                        <li class="page-item {% if p == page %}active{% endif %}">
                                            <a class="page-link" href="{{ url_for('topics', page=p) }}">{{ p }}</a>
                                        </li>
                                        {% endfor %}
                                        
                                        {% if page < (total_topics + per_page - 1) // per_page %}
                                        <li class="page-item">
                                            <a class="page-link" href="{{ url_for('topics', page=page+1) }}">
                                                <i class="fas fa-chevron-right"></i>
                                            </a>
                                        </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 System Design Topic Generator. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Powered by Gemini 2.5 Flash AI</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/topics.js') }}"></script>
</body>
</html>
